pipeline {
    agent any

    options {
        buildDiscarder(logRotator(daysToKeepStr: '10', numToKeepStr: '10'))
        timeout(time: 1, unit: 'HOURS')
        timestamps()
    }

    stages {

        stage('Checkout') {
            steps {
                checkout scm
                echo "Repository checked out successfully"
            }
        }

        stage('Build & Test Hello') {
            steps {
                sh '''
                set -e

                echo "Python version:"
                python3 --version
                pip3 --version

                # install pytest
                pip3 install pytest

                # ensure repo root is importable
                export PYTHONPATH="$(pwd)"

                echo "Running hello() demo"
                python - <<'PY'
from agents.hello import hello
print(hello())
PY

                echo "Running pytest"
                python3 -m pytest tests/test_hello.py -q
                '''
            }
        }
    }

    post {
        always {
            echo 'Pipeline finished.'
        }
    }
}
