pipeline {
    agent any

    options {
        // keep logs minimal
        buildDiscarder(logRotator(daysToKeepStr: '10', numToKeepStr: '10'))
        // timeout long-running jobs
        timeout(time: 12, unit: 'HOURS')
        // timestamps in console
        timestamps()
    }

    stages {
        stage('Checkout') {
            steps {
                // checkout the repository from the job's SCM
                checkout scm
            }
        }

        stage('Build & Test Hello') {
            steps {
                echo 'Running hello script and basic tests...'
                sh '''#!/bin/bash -l
set -euo pipefail

# ensure repo root is importable
export PYTHONPATH="$(pwd)"

# run the hello function
python3 - <<'PY'
from agents.hello import hello
print(hello())
PY

# run pytest for only the hello test if pytest is available
if command -v pytest >/dev/null 2>&1; then
  pytest -q tests/test_hello.py || true
else
  echo "pytest not available; skipping pytest run"
fi
'''
            }
        }
    }

    post {
        always {
            echo 'Pipeline finished.'
        }
    }
}

